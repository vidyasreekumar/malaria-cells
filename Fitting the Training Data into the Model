from keras.preprocessing.image import ImageDataGenerator
train_datagen = ImageDataGenerator(
             rescale = 1/255,
             shear_range = 0.2,
             zoom_range = 0.2,
             horizontal_flip = True,
             vertical_flip = True)
             
test_datagen = ImageDataGenerator(rescale = 1/255)
batchSize = 120
training_set = train_datagen.flow_from_directory(
             '/content/project/Train',
             target_size = (50,50),
             batch_size = batchSize,
             class_mode = 'binary')
training_set.class_indices
validate_set = test_datagen.flow_from_directory(
             '/content/project/Validation',
             target_size = (50,50),
             batch_size = batchSize,
             class_mode = 'binary')
no_of_steps_per_epoch_training = int(9645/batchSize)
no_of_steps_per_epoch_validating = int(1377/batchSize)
print(no_of_steps_per_epoch_training)
print(no_of_steps_per_epoch_validating)
history = classifier.fit_generator(
              training_set,
              steps_per_epoch = no_of_steps_per_epoch_training,
              epochs = 7,
              validation_data = validate_set,
              validation_steps = no_of_steps_per_epoch_validating
              )
              
test_datagen_1 = ImageDataGenerator(rescale = 1/255)
test_generator = test_datagen_1.flow_from_directory(
    directory='/content/project/Test',
    target_size=(50, 50),
    batch_size=batchSize,
    class_mode='binary'
)
no_of_steps_per_epoch_testing = 2755/batchSize
classifier.evaluate_generator(generator=test_generator,steps = no_of_steps_per_epoch_testing)
from google.colab import drive
drive.mount('/content/drive')
classifier.save('/content/drive/My Drive/Training Model/Malaria_latest120.h5')

import cv2
import numpy as np
from keras.preprocessing import image

resized=image.load_img('/content/cell_images/Parasitized/C100P61ThinF_IMG_20150918_144104_cell_163.png',target_size=(50,50))
resized = image.img_to_array(resized)
resized = np.expand_dims(resized, axis = 0)
   
result = classifier.predict(resized)
print(result)
if result == [[0.]]:
  print("\nParasitized")
if result == [[1.]]:
  print("\nUninfected")

print("Actual: Paratisized")

count=0
for i in os.listdir('/content/project/Test/uninfected_test'):
    print(i)
    resized=image.load_img('/content/project/Test/uninfected_test/'+i,target_size=(50,50)) 
    resized = image.img_to_array(resized)
    resized = np.expand_dims(resized, axis = 0)
    result = classifier.predict(resized)

print('\n\n',result)
if result == [[0.]]:
    print("\nParasitized")
if result == [[1.]]:
    print("\nUninfected")

import matplotlib.pyplot as plt
plt.plot(history.history['acc'])
plt.plot(history.history['val_acc'])
plt.title('model accuracy')
plt.ylabel('accuracy')
plt.xlabel('epoch')
plt.legend(['train', 'test'], loc='upper left')
plt.show()

plt.plot(history.history['loss'])
plt.plot(history.history['val_loss'])
plt.title('model loss')
plt.ylabel('loss')
plt.xlabel('epoch')
plt.legend(['train', 'test'], loc='upper left')
plt.show()


 
